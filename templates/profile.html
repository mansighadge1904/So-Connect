{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="profile-container">
    <main class="profile-content">
        <div class="profile-header">
            <div class="profile-img">
                <a href="{% url 'profile' username=request.user.username %}">
                    {% if request.user.profile.image %}
                        <img src="{{ user.profile.image.url }}" alt="Profile">
                    {% else %}
                        <i class="uil uil-user"></i>
                    {% endif %}
                </a>
            </div>
            <div class="profile-info">
                <h2 class="username">{{ user.username }}'s Profile</h2>
                <p><strong>Email:</strong> {{ user.email }}</p>
                <p><strong>Hobbies:</strong>
                    {% if profile.hobbies.all %}
                        {% for hobby in user.profile.hobbies.all %}
                            {{ hobby.name }}{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                    {% else %}
                        No hobby listed
                    {% endif %}
                </p>
                
                <div class="profile-stats">
                    <span><strong>Posts:</strong> {{ post_count }}</span>
                    <span><strong>Followers:</strong> {{ follower_count }}</span>
                    <span><strong>Following:</strong> {{ following_count }}</span>
                </div>
                <!-- Follow/Unfollow Button -->
                {% if request.user != user_profile %}
                    <form action="{% url 'follow_user' user_profile.id %}" method="POST">
                        {% csrf_token %}
                        {% if is_following %}
                            <button type="submit" class="btn btn-danger" style="padding: 5px; width: 80px;">Unfollow</button>
                        {% else %}
                            <button type="submit" class="btn btn-primary">Follow</button>
                        {% endif %}
                    </form>
                {% endif %}
            </div>
        </div>
        

        <hr style="width: 100%; border: 1px solid #eee; margin-bottom: 20px;">

        <div class="post-grid">
            {% for item in posts_with_counts %}
                {% with post=item.post like_count=item.like_count comment_count=item.comment_count %}
                    <div class="post">
                        {% if post.image %}
                            <img src="{{ post.image.url }}" alt="{{ post.caption }}">
                            <div class="overlay">
                                <div class="overlay-content">
                                    <i class="far fa-heart"></i> {{ like_count }}
                                    <i class="far fa-comment"></i> {{ comment_count }}
                                </div>
                            </div>
                        {% endif %}
                        <div class="post-actions">
                            <i class="far fa-heart action-icon"></i>
                            <i class="far fa-comment action-icon"></i>
                        </div>
                        <div class="post-details">
                            <p class="post-caption">{{ post.caption }}</p>
                            <p class="post-date">Posted on: {{ post.created_at|date:"F j, Y" }}</p>
                        </div>
                    </div>
                {% endwith %}
            {% empty %}
                <p class="no-posts">No posts yet.</p>
            {% endfor %}
        </div>
    </main>
</div>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
        }

        .profile-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
            overflow-x: hidden;
        }

        /* Profile Content Styling */
        .profile-content {
            flex: 1;
            padding-top: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center; 
            width: 100%;
            max-width: 1200px; 
            overflow-y: auto;
        }

        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 600px;
            text-align: center;
        }

        .profile-img {
            width: 100px; /* Adjust the size as needed */
            height: 100px; /* Keep the height the same as width for a square image */
            overflow: hidden;
            border-radius: 10px; /* Optional: Add rounded corners */
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f0f0f0; /* Light background color */
        }
        .profile-img img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Ensures the image covers the square area without distortion */
        }

        .profile-img i {
            font-size: 50px; /* Icon size */
            color: #888; /* Light color for the icon */
        }

        .profile-info {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .profile-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            font-size: 1rem;
        }
        .profile-stats span {
            font-weight: bold;
        }
        .profile-stats strong {
            font-weight: bold;
        }
        button {
            margin-top: 15px;
        }
        /* Post Grid Styling */
        .post-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(150px, 1fr));
            gap: 15px;
            width: 100%;
            max-width: 600px; /* Ensure it doesn't stretch too wide */
            margin-top: 20px; /* Add space from the top */
            min-height: 400px; 
            padding-bottom: 20px;
            overflow-y: auto;
        }
        .post-grid .post {
            display: flex;
            flex-direction: column;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            background-color: #fff;
            position: relative; 
        }
        .post-grid img {
            width: 100%;
            height: auto;
            aspect-ratio: 1 /1;
            object-fit: cover;
            border-radius: 5px;
        }

        .post-actions {
            display: flex;
            justify-content: space-around;
            padding: 5px;
        }

        .post-details {
            padding: 5px;
        }

        .no-posts {
            text-align: center;
            font-size: 1.2rem;
            font-style: italic;
            color: #777;
            margin-top: 20px;
        }
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }
        .post:hover .overlay {
            opacity: 1;
        }

        .overlay-content {
            display: flex;
            gap: 15px;
            font-weight: bold;
        }
        .overlay-content i {
            margin-right: 5px;
        }
        .post-grid .post {
            position: relative; /* For overlay positioning */
        }
    </style>
{% endblock content %}