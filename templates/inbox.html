<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ENjdO4Dr2bkBIFxQpeo6lYE1Fhb8QvE1QZr4lG1ZT13GpV8CvH+KkV9MuGxw66u2" crossorigin="anonymous">
{% extends 'base.html' %}

{% block content %}
<style>
    .chat-container {
        height: 85vh;
        display: flex;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        background: #fff;
    }
    .user-list {
        width: 30%;
        background: #f7f7f7;
        border-right: 1px solid #ddd;
        overflow-y: auto;
    }
    .user {
        padding: 15px;
        border-bottom: 1px solid #eee;
        cursor: pointer;
        font-weight: 500;
    }
    .user:hover, .user.active {
        background: #e0e0e0;
    }
    .chat-box {
        width: 70%;
        display: flex;
        flex-direction: column;
    }
    .messages {
        flex-grow: 1;
        padding: 20px;
        overflow-y: auto;
        background: #fafafa;
    }
    .message {
        margin-bottom: 15px;
        max-width: 60%;
        padding: 10px 15px;
        border-radius: 20px;
        clear: both;
        font-size: 14px;
    }
    .sent {
        background: #d1e7dd;
        margin-left: auto;
    }
    .received {
        background: #e2e3e5;
        margin-right: auto;
    }
    .chat-input {
        padding: 15px;
        border-top: 1px solid #ddd;
        background: #fff;
    }
</style>

<div class="container my-4">
    <div class="chat-container">
        <!-- User list -->
        <div class="user-list list-group">
            {% for message in messages %}
                <a href="#" class="list-group-item list-group-item-action border-0 {% if message.user.username == active_direct %}active{% endif %}">
                    <div class="d-flex align-items-center">
                        <img src="{{ message.user.profile.image.url }}" class="rounded-circle me-2" alt="img" width="45" height="45" style="object-fit: cover;">
                        <div class="flex-grow-1">
                            <strong>@{{ message.user.username }}</strong>
                            <div class="small text-muted">
                                <i class="fas fa-circle text-success"></i> Online
                            </div>
                        </div>
                    </div>
                </a>
            {% endfor %}
        </div>
        <!-- Chat area -->
        <div class="chat-box">
            <div class="messages">
                {% for direct in directs %}
                    {% if direct.sender == request.user %}
                        <div class="message sent">
                            {{ direct.body }}
                        </div>
                    {% else %}
                        <div class="message received">
                            {{ direct.body }}
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
            <div class="chat-input">
                <form method="post">
                    {% csrf_token %}
                    <div class="input-group">
                        <input type="text" class="form-control" name="body" placeholder="Type a message..." required>
                        <button class="btn btn-primary" type="submit">Send</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
