{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoConnect: Connecting people with shared hobbies</title>
    <link rel="stylesheet" href="{% static 'assets1/style.css' %}">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v2.1.6/css/unicons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        /* Add custom styles for the notification dropdown */
        .notification-container {
            position: relative;
            display: inline-block;
        }

        #notifications {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background-color: #fff;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 10px 0;
            margin-top: 10px;
            z-index: 1000;
            min-width: 250px;
        }

        #notifications.show {
            display: block;
        }

        #notifications .notification-item {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: #333;
        }

        #notifications .notification-item:last-child {
            border-bottom: none;
        }

        #notifications .notification-item:hover {
            background-color: #f8f8f8;
        }

        #notifications .notification-item img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        #notifications .notification-item .notification-content {
            flex: 1;
        }

        #notifications .notification-item .notification-content p {
            margin: 0;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        #notifications .notification-item .notification-content small {
            display: block;
            color: #888;
            font-size: 0.75rem;
        }

        .notification-icon {
            cursor: pointer;
        }

        /* Additional styling for consistency with Instagram */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #fafafa;
            color: #262626;
            margin: 0;
        }

        nav {
            background-color: #fff;
            border-bottom: 1px solid #dbdbdb;
            padding: 1rem 0;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 100;
        }

        nav .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px; /* Increased max-width */
            margin: 0 auto;
            padding: 0 20px;
        }

        nav .logo {
            font-family: 'Billabong', cursive;
            font-size: 2rem;
            margin-right: 2rem;
            color: #262626;
        }

        .search-bar {
            background-color: #efefef;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            width: 200px;
        }

        .search-bar input {
            border: none;
            background-color: transparent;
            font-size: 0.9rem;
            width: 100%;
            margin-left: 0.5rem;
        }
        #search-results {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
        }

        #search-results a {
            display: block;
            padding: 10px;
            text-decoration: none;
            color: black;
        }

        #search-results a:hover {
            background: #f0f0f0;
        }

        .create {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .btn-primary {
            background-color: #0095f6;
            color: #fff;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .btn-primary:hover {
            background-color: #0078d7;
        }

        .profile-photo {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            overflow: hidden;
            border: 1px solid #dbdbdb;
        }

        .profile-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        main {
            margin-top: 4rem;
            background-color: #fafafa;
            padding-bottom: 2rem;
        }

        main .container {
            display: flex;
            justify-content: center;
            max-width: 1200px; /* Increased max-width */
            margin: 0 auto;
            padding: 0 20px;
        }

        .left {
            width: 250px;
            margin-right: 2rem;
            margin-top: 1rem;
            position: sticky;
            top: 5rem;
            height: calc(100vh - 5rem);
            overflow-y: auto;
        }

        .left .logo-container {
            margin-bottom: 2rem;
        }

        .left .logo {
            max-width: 150px;
        }

        .left a {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            color: #262626;
            font-weight: 500;
            text-decoration: none;
            transition: background-color 0.2s ease;
        }

        .left a:hover {
            background-color: #efefef;
        }

        .left a i {
            margin-right: 1rem;
            font-size: 1.2rem;
        }

        .middle {
            flex: 1;
            max-width: 614px;
        }

        .stories {
            display: flex;
            overflow-x: auto;
            margin-bottom: 1rem;
            padding: 1rem 0;
            background-color: #fff;
            border: 1px solid #dbdbdb;
            border-radius: 8px;
            padding-left: 10px;
        }

        .stories::-webkit-scrollbar {
            display: none;
        }

        .stories .story {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 0.5rem;
            cursor: pointer;
            flex: 0 0 auto;
        }

        .stories .story img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ff4d6d;
            margin-bottom: 0.5rem;
        }

        .stories .story .name {
            font-size: 0.8rem;
            color: #262626;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 70px;
        }

        .feeds {
            margin-top: 1rem;
        }

        .feed {
            background-color: #fff;
            border: 1px solid #dbdbdb;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            padding: 1rem;
        }

        .feed .head {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .feed .user {
            display: flex;
            align-items: center;
        }

        .feed .user .profile-photo {
            margin-right: 1rem;
            width: 2.5rem;
            height: 2.5rem;
        }

        .feed .info h3 {
            font-size: 1rem;
            margin: 0;
            color: #262626;
        }

        .feed .info small {
            font-size: 0.75rem;
            color: #8e8e8e;
        }

        .feed .edit {
            cursor: pointer;
            color: #262626;
        }

        .feed .photo {
            margin-bottom: 1rem;
            border-radius: 8px;
            overflow: hidden;
            max-height: 500px;
        }

        .feed .photo img {
            width: 100%;
            display: block;
            object-fit: contain;
            max-height: 100%;
        }

        .feed .action-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .feed .interaction-buttons {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .feed .interaction-buttons a {
            color: #262626;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .feed .interaction-buttons span {
            color: #262626;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .like-icon.liked-fill {
            color: #ed4956;
        }

        .like-icon.unliked {
            color: #262626;
        }


        .feed .bookmark {
            cursor: pointer;
            color: #262626;
            font-size: 1.2rem;
        }

        .feed .caption {
            font-size: 0.9rem;
            color: #262626;
            line-height: 1.4;
        }

        .feed .caption b {
            font-weight: 600;
        }

        .scrollbar-thin::-webkit-scrollbar {
            width: 4px;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background-color: #a78bfa;
            border-radius: 10px;
        }

    </style>
</head>
<body>
    <nav>
        <div class="container">
            <h2 class="logo">SoConnect</h2>
            <input type="text" id="search-input" placeholder="Search users..." autocomplete="off">
            <div id="search-results" class="dropdown-results"></div>          
            <div class="create">
                <a href="{% url 'create_post' %}" class="btn btn-primary">Create</a>
                
                <div class="profile-photo">
                    <a href="{% url 'profile' username=request.user.username %}">
                        {% if request.user.profile.image %}
                            <img src="{{ request.user.profile.image.url }}" alt="Profile">
                        {% else %}
                            <i class="uil uil-user"></i>
                        {% endif %}
                    </a>
                </div>
            </div>
        </div>
    </nav>
    <main>
        <div class="container">
            <div class="left">
                <div class="logo-container">
                    <img src="{% static 'assets1/soconnectlogo-2.png' %}" alt="Your Logo" class="logo">
                </div>
                <a href="{% url 'dashboard' %}"><i class="uil uil-home"></i> Home</a>
                        <a href="{% url 'notifications' %}"><i class="uil uil-bell"></i> Notifications</a>
                        <a href="#"><i class="uil uil-envelope-alt"></i> Messages</a> 
                        <a href="{% url 'profile' username=request.user.username %}"><i class="uil uil-user"></i>Profile</a>
                        <a href="{% url 'edit_profile' username=request.user.username %}"><i class="uil uil-edit"></i>Edit Profile</a>
            </div>
            <div class="middle">
                <div class="stories">
                    {% for story in stories %}
                        <div class="story">
                            {% if story.image %}
                                <img src="{{ story.image.url }}" alt="Story Image" class="story-img">
                            {% else %}
                                <p>No image</p>
                            {% endif %}
                            <p class="name">@{{ story.user.username }}</p>
                            <p>DEBUG: {{ story.id }}</p>
                        </div>
                    {% empty %}
                        <p>No stories available</p>
                        <p>DEBUG: Stories queryset is empty</p>
                    {% endfor %}
                </div>
                
                <div class="feeds">
                    {% for post in posts %}
                        <div class="feed" data-post-id="{{ post.id }}">
                            <div class="head">
                                <div class="user">
                                    <div class="profile-photo">
                                        {% if post.user.profile.image %}
                                            <img src="{{ post.user.profile.image.url }}" alt="Profile Photo">
                                        {% else %}
                                            <i class="uil uil-user"></i>
                                        {% endif %}
                                    </div>
                                    <div class="info">
                                        <h3><a href="{% url 'profile' username=post.user.username %}">{{ post.user.username }}</a></h3>
                                        <small>{{ post.created_at }}</small>
                                    </div>
                                </div>
                                <span class="edit">
                                    <i class="uil uil-ellipsis-h"></i>
                                </span>
                            </div>
                            <div class="photo">
                                {% if post.image %}
                                    <img src="{{ post.image.url }}" alt="Post Image">
                                {% endif %}
                            </div>
                            <div class="action-buttons">
                                <div class="interaction-buttons">
                                    <button class="like-button" data-post-id="{{ post.id }}">
                                        <span class="like-icon {% if request.user in post.likes.all %}liked-fill{% else %}unliked{% endif %}">
                                            <i class="{% if request.user in post.likes.all %}fas fa-heart{% else %}far fa-heart{% endif %}"></i>
                                        </span>
                                        <span class="like-count" id="like-count-{{ post.id }}">{{ post.likes.count }}</span>
                                    </button>                                                                        
                                    <span><i class="ui uil-comment-dots"></i></span>
                                    <span><i class="ui uil-share-alt"></i></span>
                                </div>
                                <div class="bookmark">
                                    <span><i class="ui uil-bookmark-full"></i></span>
                                </div>
                            </div>
                            <div class="caption">
                                <p><b>{{ post.user.username }}</b> {{ post.caption }}</p>
                            </div>
                        </div>
                    {% empty %}
                        <p>No posts to display.</p>
                    {% endfor %}
                </div>
            </div>
                       
        </div>
    </main>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <!-- <script src="{% static 'assets1/script.js' %}"></script> -->
    <script>
        document.querySelectorAll('.like-button').forEach(button => {
            button.addEventListener('click', function (e) {
                e.preventDefault();
        
                const postId = this.getAttribute('data-post-id');
                const likeIcon = this.querySelector('.like-icon i');
                const likeCount = document.getElementById(`like-count-${postId}`);
        
                fetch(`/like-post/${postId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}',
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.liked) {
                        likeIcon.classList.remove('far');
                        likeIcon.classList.add('fas');
                    } else {
                        likeIcon.classList.remove('fas');
                        likeIcon.classList.add('far');
                    }
                    likeCount.textContent = data.likes_count;
                });
            });
        });
        
        document.getElementById('search-input').addEventListener('input', function() {
            const query = this.value;
            const resultsBox = document.getElementById('search-results');
            
            if (query.length > 0) {
                fetch(`/users/search-users-ajax/?q=` + query)
                    .then(response => response.json())
                    .then(data => {
                        resultsBox.innerHTML = '';
                        if (data.users.length > 0) {
                            data.users.forEach(user => {
                                const link = document.createElement('a');
                                link.href = `/users/profile/${user.username}/`;
                                link.textContent = user.username;
                                resultsBox.appendChild(link);
                            });
                        } else {
                            resultsBox.innerHTML = '<p>No users found</p>';
                        }
                        resultsBox.style.display = 'block';
                    });
            } else {
                resultsBox.style.display = 'none';
            }
        });

        </script>
        
    
</body>
</html>
